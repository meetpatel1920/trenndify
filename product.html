<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - MyShop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to right, #ffecd2, #fcb69f);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-nav {
            margin-bottom: 30px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.3);
            color: #333;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: translateX(-5px);
        }

        .product-detail {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
        }

        .product-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 500px;
        }

        .image-section {
            position: relative;
            background: #f8f8f8;
        }

        .main-image-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            cursor: pointer;
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .main-image:hover {
            transform: scale(1.05);
        }

        .image-thumbnails {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto;
        }

        .thumbnail {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .thumbnail.active {
            border-color: #ff7e5f;
            transform: scale(1.1);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-section {
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .product-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .product-price {
            font-size: 2rem;
            color: #ff7e5f;
            font-weight: bold;
            margin-bottom: 25px;
        }

        .product-description {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #666;
            margin-bottom: 30px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: auto;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff7e5f, #feb47b);
            color: white;
            flex: 2;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 126, 95, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #ff7e5f;
            border: 2px solid #ff7e5f;
            flex: 1;
        }

        .btn-secondary:hover {
            background: #ff7e5f;
            color: white;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            font-size: 1.2rem;
            color: #666;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff7e5f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .not-found {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .not-found h2 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 15px;
        }

        .not-found p {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 30px;
        }

        /* Image Popup Styles */
        .image-popup {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            animation: fadeIn 0.3s ease;
        }

        .image-popup-content {
            position: relative;
            margin: 5% auto;
            max-width: 90%;
            max-height: 90%;
            text-align: center;
        }

        .popup-image {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        .close-popup {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .close-popup:hover {
            color: #ff7e5f;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Order Form Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(45deg, #ff7e5f, #feb47b);
            color: white;
            padding: 20px 30px;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.8rem;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            color: white;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .close-modal:hover {
            color: #ffdddd;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff7e5f;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .order-summary {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .order-summary h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .summary-total {
            font-weight: bold;
            font-size: 1.2rem;
            color: #ff7e5f;
            border-bottom: none !important;
        }

        .submit-order {
            background: linear-gradient(45deg, #ff7e5f, #feb47b);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-order:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 126, 95, 0.4);
        }

        .success-message {
            display: none;
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        /* Phone input with country code */
        .phone-input-container {
            display: flex;
            gap: 0;
        }

        .country-code-select {
            width: 120px;
            border-radius: 10px 0 0 10px;
            border-right: none;
            background: #f8f8f8;
        }

        .phone-number-input {
            flex: 1;
            border-radius: 0 10px 10px 0;
            border-left: none;
        }

        .phone-number-input:focus+.country-code-select,
        .country-code-select:focus+.phone-number-input {
            border-color: #ff7e5f;
        }

        /* Product Suggestions */
        .product-suggestions {
            margin-top: 40px;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .suggestions-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
        }

        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .suggestion-card {
            background: #f8f8f8;
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .suggestion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .suggestion-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .suggestion-content {
            padding: 15px;
        }

        .suggestion-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .suggestion-price {
            font-size: 1.2rem;
            color: #ff7e5f;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .product-content {
                grid-template-columns: 1fr;
            }

            .main-image-container {
                height: 300px;
            }

            .info-section {
                padding: 30px 20px;
            }

            .product-title {
                font-size: 2rem;
            }

            .product-price {
                font-size: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .container {
                padding: 15px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 5% auto;
                width: 95%;
            }

            .modal-body {
                padding: 20px;
            }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <!-- Add flag icons CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">
</head>

<body>
    <div class="container">
        <div class="back-nav">
            <a href="index.html" class="back-btn">
                ← Back to Shop
            </a>
        </div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>Loading product details...</div>
        </div>

        <div id="product-detail" class="product-detail" style="display: none;">
            <div class="product-content">
                <div class="image-section">
                    <div class="main-image-container" onclick="openImagePopup()">
                        <img id="main-image" class="main-image" src="" alt="">
                    </div>
                    <div id="image-thumbnails" class="image-thumbnails">
                        <!-- Thumbnails will be populated here -->
                    </div>
                </div>

                <div class="info-section">
                    <h1 id="product-title" class="product-title"></h1>
                    <div id="product-price" class="product-price"></div>
                    <div id="product-description" class="product-description"></div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="openOrderForm()">
                            🛒 Buy Now
                        </button>
                        <button class="btn btn-secondary" onclick="addToWishlist()">
                            💝 Wishlist
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="not-found" class="not-found" style="display: none;">
            <h2>Product Not Found</h2>
            <p>Sorry, the product you're looking for doesn't exist or has been removed.</p>
            <a href="index.html" class="btn btn-primary">Back to Shop</a>
        </div>

        <!-- Product Suggestions -->
        <div id="product-suggestions" class="product-suggestions" style="display: none;">
            <h2 class="suggestions-title">You Might Also Like</h2>
            <div id="suggestions-grid" class="suggestions-grid">
                <!-- Suggestions will be populated here -->
            </div>
        </div>
    </div>

    <!-- Image Popup -->
    <div id="image-popup" class="image-popup" onclick="closeImagePopup()">
        <div class="image-popup-content">
            <span class="close-popup" onclick="closeImagePopup()">&times;</span>
            <img id="popup-image" class="popup-image" src="" alt="">
        </div>
    </div>

    <!-- Order Form Modal -->
    <div id="order-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Complete Your Order</h2>
                <span class="close-modal" onclick="closeOrderForm()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="success-message" class="success-message">
                    <strong>Order Placed Successfully!</strong> Your order has been received and will be processed soon.
                </div>

                <div class="order-summary">
                    <h3>Order Summary</h3>
                    <div class="summary-item">
                        <span id="summary-product">Product Name</span>
                        <span id="summary-price">₹0</span>
                    </div>
                    <div class="summary-item">
                        <span>Quantity:</span>
                        <span id="summary-qty">1</span>
                    </div>
                    <div class="summary-item summary-total">
                        <span>Total Amount:</span>
                        <span id="summary-total">₹0</span>
                    </div>
                </div>

                <form id="order-form">
                    <div class="form-group">
                        <label for="customer-name">Full Name *</label>
                        <input type="text" id="customer-name" name="customerName" required>
                    </div>

                    <div class="form-group">
                        <label for="customer-phone">Phone Number *</label>
                        <div class="phone-input-container" style="display: flex; gap: 8px;">
                            <select id="country-code" class="country-code-select" onchange="updatePhoneValidation()"
                                style="width: 100px; font-size: 0.85rem;">
                                <option value="+91" data-digits="10" data-country="in" selected>🇮🇳 +91</option>
                                <option value="+1" data-digits="10" data-country="us">🇺🇸 +1</option>
                                <option value="+44" data-digits="10" data-country="gb">🇬🇧 +44</option>
                                <option value="+61" data-digits="9" data-country="au">🇦🇺 +61</option>
                                <option value="+33" data-digits="10" data-country="fr">🇫🇷 +33</option>
                                <option value="+49" data-digits="11" data-country="de">🇩🇪 +49</option>
                                <option value="+81" data-digits="10" data-country="jp">🇯🇵 +81</option>
                                <option value="+86" data-digits="11" data-country="cn">🇨🇳 +86</option>
                                <option value="+971" data-digits="9" data-country="ae">🇦🇪 +971</option>
                                <option value="+966" data-digits="9" data-country="sa">🇸🇦 +966</option>
                            </select>

                            <input type="tel" id="customer-phone" name="customerPhone" class="phone-number-input"
                                pattern="[0-9]{10}" maxlength="10" minlength="10" required
                                placeholder="Enter 10 digit number" style="flex: 1;">
                        </div>
                        <small id="phone-helper" style="color: #666; font-size: 0.85rem;">Enter 10 digits for
                            India</small>
                    </div>


                    <div class="form-group">
                        <label for="customer-email">Email Address *</label>
                        <input type="email" id="customer-email" name="customerEmail" required>
                    </div>

                    <div class="form-group">
                        <label for="quantity">Quantity *</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button type="button" onclick="changeQty(-1)" style="padding: 5px 10px;">−</button>
                            <input type="number" id="quantity" name="quantity" min="1" max="50" value="1" required
                                oninput="validateQty()" style="width: 80px; text-align: center;">
                            <button type="button" onclick="changeQty(1)" style="padding: 5px 10px;">＋</button>
                        </div>
                    </div>



                    <div class="form-group">
                        <label for="shipping-address">Shipping Address *</label>
                        <textarea id="shipping-address" name="shippingAddress" rows="3" required
                            placeholder="Enter your complete address including area and landmark"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="country">Country *</label>
                            <select id="country" name="country" onchange="updateStates()" required>
                                <option value="">Select Country</option>
                                <option value="IN" selected>India</option>
                                <option value="US">United States</option>
                                <option value="GB">United Kingdom</option>
                                <option value="AU">Australia</option>
                                <option value="CA">Canada</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="state">State *</label>
                            <select id="state" name="state" onchange="updateCities()" required>
                                <option value="">Select State</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <select id="city" name="city" required>
                                <option value="">Select City</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pincode">Pincode *</label>
                            <input type="text" id="pincode" name="pincode" pattern="[0-9]{6}" maxlength="6" required
                                placeholder="Enter 6 digit pincode">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="special-instructions">Special Instructions (Optional)</label>
                        <textarea id="special-instructions" name="specialInstructions" rows="2"
                            placeholder="Any special delivery instructions..."></textarea>
                    </div>

                    <button type="submit" class="submit-order">Place Order - ₹<span id="final-total">0</span></button>
                </form>
            </div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');

        let currentProduct = null;

        // Country-State-City Data
        const locationData = {
            'IN': {
                name: 'India',
                states: {
                    'Gujarat': ['Ahmedabad', 'Surat', 'Vadodara', 'Rajkot', 'Bhavnagar', 'Jamnagar', 'Junagadh', 'Gandhinagar', 'Anand', 'Navsari'],
                    'Maharashtra': ['Mumbai', 'Pune', 'Nagpur', 'Thane', 'Nashik', 'Aurangabad', 'Solapur', 'Amravati', 'Kolhapur', 'Sangli'],
                    'Delhi': ['New Delhi', 'Delhi Cantonment', 'Karol Bagh', 'Lajpat Nagar', 'Saket', 'Dwarka', 'Rohini', 'Janakpuri'],
                    'Karnataka': ['Bangalore', 'Mysore', 'Hubli', 'Mangalore', 'Belgaum', 'Gulbarga', 'Davanagere', 'Bellary'],
                    'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai', 'Tiruchirappalli', 'Salem', 'Tirunelveli', 'Erode', 'Vellore'],
                    'Rajasthan': ['Jaipur', 'Jodhpur', 'Kota', 'Bikaner', 'Ajmer', 'Udaipur', 'Bhilwara', 'Alwar'],
                    'West Bengal': ['Kolkata', 'Howrah', 'Durgapur', 'Asansol', 'Siliguri', 'Malda', 'Bardhaman', 'Kharagpur'],
                    'Uttar Pradesh': ['Lucknow', 'Kanpur', 'Ghaziabad', 'Agra', 'Meerut', 'Varanasi', 'Allahabad', 'Bareilly']
                }
            },
            'US': {
                name: 'United States',
                states: {
                    'California': ['Los Angeles', 'San Francisco', 'San Diego', 'Sacramento', 'San Jose', 'Fresno', 'Long Beach'],
                    'New York': ['New York City', 'Buffalo', 'Rochester', 'Yonkers', 'Syracuse', 'Albany', 'New Rochelle'],
                    'Texas': ['Houston', 'San Antonio', 'Dallas', 'Austin', 'Fort Worth', 'El Paso', 'Arlington'],
                    'Florida': ['Miami', 'Jacksonville', 'Tampa', 'Orlando', 'St. Petersburg', 'Hialeah', 'Tallahassee']
                }
            },
            'GB': {
                name: 'United Kingdom',
                states: {
                    'England': ['London', 'Birmingham', 'Manchester', 'Liverpool', 'Leeds', 'Sheffield', 'Bristol'],
                    'Scotland': ['Edinburgh', 'Glasgow', 'Aberdeen', 'Dundee', 'Stirling', 'Perth', 'Inverness'],
                    'Wales': ['Cardiff', 'Swansea', 'Newport', 'Wrexham', 'Barry', 'Caerphilly', 'Rhondda'],
                    'Northern Ireland': ['Belfast', 'Derry', 'Lisburn', 'Newtownabbey', 'Bangor', 'Craigavon']
                }
            },
            'AU': {
                name: 'Australia',
                states: {
                    'New South Wales': ['Sydney', 'Newcastle', 'Wollongong', 'Maitland', 'Albury', 'Wagga Wagga'],
                    'Victoria': ['Melbourne', 'Geelong', 'Ballarat', 'Bendigo', 'Frankston', 'Mildura'],
                    'Queensland': ['Brisbane', 'Gold Coast', 'Townsville', 'Cairns', 'Toowoomba', 'Rockhampton'],
                    'Western Australia': ['Perth', 'Fremantle', 'Rockingham', 'Mandurah', 'Bunbury', 'Kalgoorlie']
                }
            },
            'CA': {
                name: 'Canada',
                states: {
                    'Ontario': ['Toronto', 'Ottawa', 'Hamilton', 'London', 'Kitchener', 'Windsor'],
                    'Quebec': ['Montreal', 'Quebec City', 'Laval', 'Gatineau', 'Longueuil', 'Sherbrooke'],
                    'British Columbia': ['Vancouver', 'Victoria', 'Surrey', 'Burnaby', 'Richmond', 'Abbotsford'],
                    'Alberta': ['Calgary', 'Edmonton', 'Red Deer', 'Lethbridge', 'Medicine Hat', 'Grande Prairie']
                }
            }
        };

        function loadProduct() {
            if (!productId) {
                showNotFound();
                return;
            }

            const productRef = db.collection('products').doc(productId);

            productRef.get().then((doc) => {
                const loadingDiv = document.getElementById('loading');
                loadingDiv.style.display = 'none';

                if (!doc.exists) {
                    showNotFound();
                    return;
                }

                const product = doc.data();
                currentProduct = product;
                displayProduct(product);
                loadProductSuggestions();
            }).catch(error => {
                console.error('Error loading product:', error);
                document.getElementById('loading').style.display = 'none';
                showNotFound();
            });
        }

        function displayProduct(product) {
            const productDetailDiv = document.getElementById('product-detail');

            // Set product details
            document.getElementById('product-title').textContent = product.title;
            document.getElementById('product-price').textContent = `₹${product.price.toLocaleString()}`;
            document.getElementById('product-description').textContent = product.description;

            // Set main image
            const mainImage = document.getElementById('main-image');
            mainImage.src = product.image || product.images[0];
            mainImage.alt = product.title;

            // Create thumbnails
            if (product.images && product.images.length > 1) {
                createThumbnails(product.images);
            }

            // Show product detail
            productDetailDiv.style.display = 'block';

            // Load product suggestions
            loadProductSuggestions();
        }

        function createThumbnails(images) {
            const thumbnailsContainer = document.getElementById('image-thumbnails');
            thumbnailsContainer.innerHTML = '';

            images.forEach((imageUrl, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = `thumbnail ${index === 0 ? 'active' : ''}`;
                thumbnail.innerHTML = `<img src="${imageUrl}" alt="Product image ${index + 1}">`;

                thumbnail.addEventListener('click', () => {
                    // Update main image
                    document.getElementById('main-image').src = imageUrl;

                    // Update active thumbnail
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    thumbnail.classList.add('active');
                });

                thumbnailsContainer.appendChild(thumbnail);
            });
        }

        function showNotFound() {
            document.getElementById('not-found').style.display = 'block';
        }

        // Phone validation functions
        function updatePhoneValidation() {
            const countrySelect = document.getElementById('country-code');
            const phoneInput = document.getElementById('customer-phone');
            const phoneHelper = document.getElementById('phone-helper');

            const selectedOption = countrySelect.selectedOptions[0];
            const digits = selectedOption.getAttribute('data-digits');
            const countryName = selectedOption.textContent.split(' ')[0];

            phoneInput.setAttribute('maxlength', digits);
            phoneInput.setAttribute('minlength', digits);
            phoneInput.setAttribute('pattern', `[0-9]{${digits}}`);
            phoneInput.placeholder = `Enter ${digits} digit number`;
            phoneHelper.textContent = `Enter ${digits} digits for ${countryName}`;
        }

        // Location dropdown functions
        function updateStates() {
            const countrySelect = document.getElementById('country');
            const stateSelect = document.getElementById('state');
            const citySelect = document.getElementById('city');

            // Clear existing options
            stateSelect.innerHTML = '<option value="">Select State</option>';
            citySelect.innerHTML = '<option value="">Select City</option>';

            const selectedCountry = countrySelect.value;
            if (selectedCountry && locationData[selectedCountry]) {
                const states = Object.keys(locationData[selectedCountry].states);
                states.forEach(state => {
                    const option = document.createElement('option');
                    option.value = state;
                    option.textContent = state;
                    stateSelect.appendChild(option);
                });
            }
        }

        function updateCities() {
            const countrySelect = document.getElementById('country');
            const stateSelect = document.getElementById('state');
            const citySelect = document.getElementById('city');

            // Clear existing options
            citySelect.innerHTML = '<option value="">Select City</option>';

            const selectedCountry = countrySelect.value;
            const selectedState = stateSelect.value;

            if (selectedCountry && selectedState && locationData[selectedCountry] && locationData[selectedCountry].states[selectedState]) {
                const cities = locationData[selectedCountry].states[selectedState];
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            }
        }

        // Product suggestions function
        function loadProductSuggestions() {
            if (!currentProduct) return;

            // Get related products from Firebase
            db.collection('products')
                .where('category', '==', currentProduct.category || 'general')
                .limit(6)
                .get()
                .then((querySnapshot) => {
                    const suggestions = [];
                    querySnapshot.forEach((doc) => {
                        const product = doc.data();
                        // Don't include current product
                        if (doc.id !== productId) {
                            suggestions.push({
                                id: doc.id,
                                ...product
                            });
                        }
                    });

                    // If we don't have enough from same category, get random products
                    if (suggestions.length < 3) {
                        return db.collection('products')
                            .limit(6)
                            .get()
                            .then((allProducts) => {
                                allProducts.forEach((doc) => {
                                    const product = doc.data();
                                    if (doc.id !== productId && !suggestions.find(s => s.id === doc.id)) {
                                        suggestions.push({
                                            id: doc.id,
                                            ...product
                                        });
                                    }
                                });
                                return suggestions.slice(0, 4); // Show only 4 suggestions
                            });
                    }

                    return suggestions.slice(0, 4);
                })
                .then((finalSuggestions) => {
                    displayProductSuggestions(finalSuggestions);
                })
                .catch((error) => {
                    console.error('Error loading suggestions:', error);
                });
        }

        function displayProductSuggestions(suggestions) {
            if (suggestions.length === 0) return;

            const suggestionsContainer = document.getElementById('product-suggestions');
            const suggestionsGrid = document.getElementById('suggestions-grid');

            suggestionsGrid.innerHTML = '';

            suggestions.forEach(product => {
                const suggestionCard = document.createElement('a');
                suggestionCard.href = `product.html?id=${product.id}`; // ✅ use correct file name
                suggestionCard.className = 'suggestion-card';

                suggestionCard.innerHTML = `
            <img src="${product.image || product.images[0]}" alt="${product.title}" class="suggestion-image">
            <div class="suggestion-content">
                <div class="suggestion-title">${product.title}</div>
                <div class="suggestion-price">₹${product.price.toLocaleString()}</div>
            </div>
        `;

                suggestionsGrid.appendChild(suggestionCard);
            });

            suggestionsContainer.style.display = 'block';
        }


        // Image Popup Functions
        function openImagePopup() {
            const mainImage = document.getElementById('main-image');
            const popup = document.getElementById('image-popup');
            const popupImage = document.getElementById('popup-image');

            popupImage.src = mainImage.src;
            popupImage.alt = mainImage.alt;
            popup.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeImagePopup() {
            const popup = document.getElementById('image-popup');
            popup.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Order Form Functions
        function openOrderForm() {
            if (!currentProduct) return;

            const modal = document.getElementById('order-modal');

            // Reset form and hide success message
            document.getElementById('order-form').reset();
            document.getElementById('success-message').style.display = 'none';

            // Set default values
            document.getElementById('country').value = 'IN';
            updateStates();
            updatePhoneValidation();

            // Update order summary
            document.getElementById('summary-product').textContent = currentProduct.title;
            document.getElementById('summary-price').textContent = `₹${currentProduct.price.toLocaleString()}`;
            updateOrderSummary();

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeOrderForm() {
            const modal = document.getElementById('order-modal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function updateOrderSummary() {
            if (!currentProduct) return;

            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const total = currentProduct.price * quantity;

            document.getElementById('summary-qty').textContent = quantity;
            document.getElementById('summary-total').textContent = `₹${total.toLocaleString()}`;
            document.getElementById('final-total').textContent = total.toLocaleString();
        }

        function changeQty(change) {
            const qtyInput = document.getElementById('quantity');
            let current = parseInt(qtyInput.value) || 1;
            current += change;

            if (current < 1) current = 1;
            if (current > 50) current = 50;

            qtyInput.value = current;
            updateOrderSummary();
        }


        function validateQty() {
            const qtyInput = document.getElementById('quantity');
            let qty = parseInt(qtyInput.value) || 1;

            if (qty < 1) qty = 1;
            if (qty > 50) qty = 50;

            qtyInput.value = qty;
            updateOrderSummary();
        }
        // Handle Order Form Submission
        document.getElementById('order-form').addEventListener('submit', function (e) {
            e.preventDefault();

            if (!currentProduct) return;

            const formData = new FormData(this);
            const quantity = parseInt(formData.get('quantity'));
            const totalAmount = currentProduct.price * quantity;

            const orderData = {
                productId: productId,
                productTitle: currentProduct.title,
                productPrice: currentProduct.price,
                productImage: currentProduct.image || currentProduct.images[0],
                customerName: formData.get('customerName'),
                customerPhone: formData.get('countryCode') + formData.get('customerPhone'),
                customerEmail: formData.get('customerEmail'),
                quantity: quantity,
                totalAmount: totalAmount,
                shippingAddress: formData.get('shippingAddress'),
                country: formData.get('country'),
                state: formData.get('state'),
                city: formData.get('city'),
                pincode: formData.get('pincode'),
                specialInstructions: formData.get('specialInstructions') || '',
                orderDate: new Date().toISOString(),
                orderStatus: 'pending'
            };

            // Add order to Firebase
            db.collection('orders').add(orderData)
                .then((docRef) => {
                    console.log('Order added with ID: ', docRef.id);

                    // Show success message
                    document.getElementById('success-message').style.display = 'block';

                    // Hide form
                    document.getElementById('order-form').style.display = 'none';

                    // Auto close after 3 seconds
                    setTimeout(() => {
                        closeOrderForm();
                        document.getElementById('order-form').style.display = 'block';
                    }, 3000);
                })
                .catch((error) => {
                    console.error('Error adding order: ', error);
                    alert('Error placing order. Please try again.');
                });
        });

        function addToWishlist() {
            if (!currentProduct) return;

            const wishlistItem = {
                productId: productId,
                productTitle: currentProduct.title,
                productPrice: currentProduct.price,
                productImage: currentProduct.image || currentProduct.images[0],
                addedDate: new Date().toISOString()
            };

            // Add to wishlist collection
            db.collection('wishlist').add(wishlistItem)
                .then((docRef) => {
                    console.log('Item added to wishlist with ID: ', docRef.id);
                    alert(`"${currentProduct.title}" has been added to your wishlist! 💝`);
                })
                .catch((error) => {
                    console.error('Error adding to wishlist: ', error);
                    alert('Error adding to wishlist. Please try again.');
                });
        }

        // Close modals when clicking outside
        window.onclick = function (event) {
            const orderModal = document.getElementById('order-modal');
            const imagePopup = document.getElementById('image-popup');

            if (event.target === orderModal) {
                closeOrderForm();
            }
            if (event.target === imagePopup) {
                closeImagePopup();
            }
        }

        // Close popup with Escape key
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                closeImagePopup();
                closeOrderForm();
            }
        });

        // Initialize
        loadProduct();
    </script>
</body>

</html>